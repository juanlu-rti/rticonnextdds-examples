<?xml version="1.0" encoding="UTF-8"?>

<!-- All of our files start with a dds tag -->
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="https://community.rti.com/schema/6.0.1/rti_converter.xsd">

    <!-- The name of the library, and the function used to create an instance
         of the StorageReader -->
    <plugin_library name="StorageLibrary">
        <storage_plugin name="LevelDb">
            <dll>LevelDbReader</dll>
            <create_function>LevelDbReader_get_storage_reader</create_function>
        </storage_plugin>
    </plugin_library>

    <converter name="LevelDb_To_SQLiteCDR">
        <input_storage>
            <plugin plugin_name="StorageLibrary::LevelDb">
                <property>
                    <value>
                        <element>
                            <name>rti.recording.examples.leveldb.working_dir</name>
                            <value>$(LEVELDB_WORKING_DIR)</value>
                        </element>
                    </value>
                </property>
            </plugin>
        </input_storage>
        <output_storage>
            <sqlite>
                <storage_format>XCDR_AUTO</storage_format>
                <fileset>
                    <workspace_dir>$(LEVELDB_WORKING_DIR)/converted_cdr</workspace_dir>
                    <filename_expression>db.dat</filename_expression>
                </fileset>
            </sqlite>
        </output_storage>
        <domain_participant name="Domain0">
            <domain_id>0</domain_id>
        </domain_participant>
        <session name="Session">
            <topic_group name="AllExceptRti" participant_ref="Domain0">
                <allow_topic_name_filter>*</allow_topic_name_filter>
                <deny_topic_name_filter>rti/*</deny_topic_name_filter>
            </topic_group>
        </session>
    </converter>
    
    <converter name="LevelDb_To_SQLiteJSON">
        <input_storage>
            <plugin plugin_name="StorageLibrary::LevelDb">
                <property>
                    <value>
                        <element>
                            <name>rti.recording.examples.leveldb.working_dir</name>
                            <value>$(LEVELDB_WORKING_DIR)</value>
                        </element>
                    </value>
                </property>
            </plugin>
        </input_storage>
        <output_storage>
            <sqlite>
                <storage_format>JSON_SQLITE</storage_format>
                <fileset>
                    <workspace_dir>$(LEVELDB_WORKING_DIR)/converted_json</workspace_dir>
                    <filename_expression>db.dat</filename_expression>
                </fileset>
            </sqlite>
        </output_storage>
        <domain_participant name="Domain0">
            <domain_id>0</domain_id>
        </domain_participant>
        <session name="Session">
            <topic_group name="AllExceptRti" participant_ref="Domain0">
                <allow_topic_name_filter>*</allow_topic_name_filter>
                <deny_topic_name_filter>rti/*</deny_topic_name_filter>
            </topic_group>
        </session>
    </converter>
    
</dds>
